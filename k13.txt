<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Rapor K13 SD Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #2c5282;
            --secondary: #4299e1;
            --success: #38a169;
            --danger: #e53e3e;
            --warning: #d69e2e;
            --light: #f7fafc;
            --dark: #1a202c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease-in-out;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 10px;
            padding: 0;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card-header {
            padding: 18px 25px;
            background: var(--light);
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            color: var(--primary);
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .card-header .toggle-icon {
            transition: transform 0.3s ease;
        }

        .card-header.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }

        .card-body {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .card-body.show {
            padding: 25px;
            max-height: 2000px;
        }

        /* Form Styles */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2a4365;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #2f855a;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Table Styles */
        .table-responsive {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease-in-out;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .table th, .table td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .table tr:nth-child(even) {
            background: #f8fafc;
        }

        .table tr:hover {
            background: #ebf8ff;
        }

        /* Predikat Styles */
        .predikat {
            font-weight: bold;
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            display: inline-block;
            min-width: 30px;
        }

        .predikat-A { background: var(--success); }
        .predikat-B { background: var(--secondary); }
        .predikat-C { background: var(--warning); color: #fff; }
        .predikat-D { background: var(--danger); }

        /* Status Tuntas */
        .tuntas { background: #f0fff4; }
        .tidak-tuntas { background: #fff5f5; }

        /* Rata-rata */
        .rata-rata {
            font-weight: bold;
            background: #ebf8ff;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-in-out;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-header h3 {
            color: var(--primary);
            margin: 0;
        }

        .modal-footer {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* TTD Styles */
        .ttd-section {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .ttd-box {
            text-align: center;
        }

        .ttd-space {
            height: 80px;
            margin: 20px 0;
            border-bottom: 1px solid var(--dark);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .ttd-section {
                grid-template-columns: 1fr;
            }
            
            .btn {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            #raporPreview, #raporPreview * {
                visibility: visible;
            }
            #raporPreview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 0;
                margin: 0;
                box-shadow: none;
                background: white;
            }
            .no-print {
                display: none;
            }
            .card-header {
                background: white !important;
            }
            .card-body {
                max-height: none !important;
                padding: 20px !important;
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-book-open"></i> APLIKASI RAPOR K13 SD</h1>
            <p>Kurikulum 2013 Revisi 2019 - Sekolah Dasar</p>
        </div>

        <!-- Data Sekolah -->
        <div class="card">
            <div class="card-header collapsed" onclick="toggleCard(this)">
                <h2><i class="fas fa-school"></i> Data Sekolah</h2>
                <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="namaSekolah">Nama Sekolah</label>
                        <input type="text" id="namaSekolah" class="form-control" value="SDN 01 Contoh">
                    </div>
                    <div class="form-group">
                        <label for="npsn">NPSN</label>
                        <input type="text" id="npsn" class="form-control" value="12345678">
                    </div>
                    <div class="form-group">
                        <label for="alamatSekolah">Alamat Sekolah</label>
                        <input type="text" id="alamatSekolah" class="form-control" value="Jl. Pendidikan No. 1, Kota Contoh">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="namaKepalaSekolah">Nama Kepala Sekolah</label>
                        <input type="text" id="namaKepalaSekolah" class="form-control" value="Dr. Ahmad Fauzi, M.Pd.">
                    </div>
                    <div class="form-group">
                        <label for="nipKepalaSekolah">NIP Kepala Sekolah</label>
                        <input type="text" id="nipKepalaSekolah" class="form-control" value="19651231 199203 1 001">
                    </div>
                    <div class="form-group">
                        <label for="kkmSekolah">KKM Sekolah</label>
                        <input type="number" id="kkmSekolah" class="form-control" value="75" min="0" max="100">
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Siswa -->
        <div class="card">
            <div class="card-header collapsed" onclick="toggleCard(this)">
                <h2><i class="fas fa-user-graduate"></i> Data Siswa</h2>
                <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="namaSiswa">Nama Siswa</label>
                        <input type="text" id="namaSiswa" class="form-control" value="Ananda Putri">
                    </div>
                    <div class="form-group">
                        <label for="nis">NIS</label>
                        <input type="text" id="nis" class="form-control" value="12345">
                    </div>
                    <div class="form-group">
                        <label for="nisn">NISN</label>
                        <input type="text" id="nisn" class="form-control" value="9876543210">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="kelas">Kelas</label>
                        <select id="kelas" class="form-control">
                            <option value="I">Kelas I</option>
                            <option value="II">Kelas II</option>
                            <option value="III">Kelas III</option>
                            <option value="IV">Kelas IV</option>
                            <option value="V" selected>Kelas V</option>
                            <option value="VI">Kelas VI</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="semester">Semester</label>
                        <select id="semester" class="form-control">
                            <option value="1">Semester 1 (Ganjil)</option>
                            <option value="2" selected>Semester 2 (Genap)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tahunAjaran">Tahun Ajaran</label>
                        <input type="text" id="tahunAjaran" class="form-control" value="2024/2025">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="namaWaliKelas">Nama Wali Kelas</label>
                        <input type="text" id="namaWaliKelas" class="form-control" value="Dewi Sartika, S.Pd.">
                    </div>
                    <div class="form-group">
                        <label for="nipWaliKelas">NIP Wali Kelas</label>
                        <input type="text" id="nipWaliKelas" class="form-control" value="19800312 200501 2 002">
                    </div>
                </div>
            </div>
        </div>

        <!-- Legger Nilai -->
        <div class="card">
            <div class="card-header" onclick="toggleCard(this)">
                <h2><i class="fas fa-table"></i> Legger Nilai Mata Pelajaran</h2>
                <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
            </div>
            <div class="card-body show">
                <div class="table-responsive">
                    <table class="table" id="leggerNilai">
                        <thead>
                            <tr>
                                <th rowspan="2">No</th>
                                <th rowspan="2">Mata Pelajaran</th>
                                <th rowspan="2">KKM</th>
                                <th colspan="3">Pengetahuan</th>
                                <th colspan="3">Keterampilan</th>
                                <th rowspan="2">Aksi</th>
                            </tr>
                            <tr>
                                <th>Nilai</th>
                                <th>Predikat</th>
                                <th>Status</th>
                                <th>Nilai</th>
                                <th>Predikat</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="leggerBody">
                            <!-- Data legger akan diisi di sini -->
                        </tbody>
                        <tfoot>
                            <tr class="rata-rata">
                                <td colspan="3"><strong>Rata-rata Kelas</strong></td>
                                <td id="avgP">0</td>
                                <td>-</td>
                                <td>-</td>
                                <td id="avgK">0</td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <button class="btn btn-success" onclick="tambahMapel()"><i class="fas fa-plus"></i> Tambah Mata Pelajaran</button>
            </div>
        </div>

        <!-- Sikap -->
        <div class="card">
            <div class="card-header collapsed" onclick="toggleCard(this)">
                <h2><i class="fas fa-heart"></i> Penilaian Sikap</h2>
                <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="sikapSpiritual">Sikap Spiritual</label>
                        <textarea id="sikapSpiritual" class="form-control" rows="3">Ananda menunjukkan sikap spiritual yang baik, selalu berdoa sebelum dan sesudah kegiatan pembelajaran.</textarea>
                    </div>
                    <div class="form-group">
                        <label for="sikapSosial">Sikap Sosial</label>
                        <textarea id="sikapSosial" class="form-control" rows="3">Ananda memiliki sikap sosial yang baik, mampu bekerja sama dengan teman dan menghargai perbedaan pendapat.</textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ekstrakurikuler -->
        <div class="card">
            <div class="card-header collapsed" onclick="toggleCard(this)">
                <h2><i class="fas fa-futbol"></i> Kegiatan Ekstrakurikuler</h2>
                <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="ekstra1">Ekstrakurikuler 1</label>
                        <input type="text" id="ekstra1" class="form-control" value="Pramuka">
                    </div>
                    <div class="form-group">
                        <label for="nilaiEkstra1">Nilai</label>
                        <select id="nilaiEkstra1" class="form-control">
                            <option value="Sangat Baik">Sangat Baik</option>
                            <option value="Baik" selected>Baik</option>
                            <option value="Cukup">Cukup</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="ekstra2">Ekstrakurikuler 2</label>
                        <input type="text" id="ekstra2" class="form-control" value="Seni Tari">
                    </div>
                    <div class="form-group">
                        <label for="nilaiEkstra2">Nilai</label>
                        <select id="nilaiEkstra2" class="form-control">
                            <option value="Sangat Baik" selected>Sangat Baik</option>
                            <option value="Baik">Baik</option>
                            <option value="Cukup">Cukup</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Catatan -->
        <div class="card">
            <div class="card-header collapsed" onclick="toggleCard(this)">
                <h2><i class="fas fa-edit"></i> Catatan</h2>
                <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="catatanWali">Catatan Wali Kelas</label>
                    <textarea id="catatanWali" class="form-control" rows="3">Ananda adalah siswa yang rajin dan disiplin. Terus pertahankan prestasinya dan tingkatkan kemampuan dalam bekerja sama dengan teman sekelas.</textarea>
                </div>
                <div class="form-group">
                    <label for="saran">Saran</label>
                    <textarea id="saran" class="form-control" rows="2">Ditingkatkan lagi kedisiplinan dalam mengumpulkan tugas tepat waktu.</textarea>
                </div>
            </div>
        </div>

        <!-- Tombol Aksi -->
        <div class="card no-print">
            <div class="card-body">
                <button class="btn btn-success" onclick="generateRapor()"><i class="fas fa-file-alt"></i> Generate Rapor</button>
                <button class="btn btn-primary" onclick="cetakRapor()"><i class="fas fa-print"></i> Cetak Rapor</button>
                <button class="btn btn-secondary" onclick="simpanData()"><i class="fas fa-save"></i> Simpan Data</button>
                <button class="btn" onclick="muatData()"><i class="fas fa-folder-open"></i> Muat Data</button>
                <button class="btn btn-danger" onclick="resetData()"><i class="fas fa-trash-alt"></i> Reset Data</button>
            </div>
        </div>

        <!-- Preview Rapor -->
        <div id="raporPreview" class="card" style="display: none;">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 id="previewNamaSekolah" style="font-size: 1.8rem; color: var(--primary);">SDN 01 CONTOH</h2>
                <h3 style="font-size: 1.4rem;">RAPOR PESERTA DIDIK SEKOLAH DASAR</h3>
                <p style="font-size: 1.1rem;">Kurikulum 2013 Revisi 2019</p>
            </div>

            <table style="width: 100%; margin-bottom: 30px; border-collapse: collapse;">
                <tr>
                    <td style="width: 25%; padding: 8px 0;">Nama Peserta Didik</td>
                    <td style="width: 2%;">:</td>
                    <td id="previewNamaSiswa" style="font-weight: 600;">Ananda Putri</td>
                    <td style="width: 15%;">Kelas</td>
                    <td style="width: 2%;">:</td>
                    <td id="previewKelas">V (Lima)</td>
                </tr>
                <tr>
                    <td style="padding: 8px 0;">NIS/NISN</td>
                    <td>:</td>
                    <td id="previewNIS">12345 / 9876543210</td>
                    <td>Semester</td>
                    <td>:</td>
                    <td id="previewSemester">2 (Genap)</td>
                </tr>
                <tr>
                    <td style="padding: 8px 0;">Nama Sekolah</td>
                    <td>:</td>
                    <td id="previewSekolahLengkap">SDN 01 Contoh</td>
                    <td>Tahun Ajaran</td>
                    <td>:</td>
                    <td id="previewTahunAjaran">2024/2025</td>
                </tr>
            </table>

            <h3 style="margin: 25px 0 15px 0; border-bottom: 2px solid var(--primary); padding-bottom: 8px; color: var(--primary);">A. SIKAP</h3>
            <table style="width: 100%; margin-bottom: 30px; border-collapse: collapse;">
                <tr>
                    <th style="width: 20%; padding: 12px; background: var(--light); text-align: left; border: 1px solid #e2e8f0;">Jenis Sikap</th>
                    <th style="width: 80%; padding: 12px; background: var(--light); text-align: left; border: 1px solid #e2e8f0;">Deskripsi</th>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid #e2e8f0;">Spiritual</td>
                    <td id="previewSikapSpiritual" style="padding: 12px; border: 1px solid #e2e8f0;">Ananda menunjukkan sikap spiritual yang baik, selalu berdoa sebelum dan sesudah kegiatan pembelajaran.</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid #e2e8f0;">Sosial</td>
                    <td id="previewSikapSosial" style="padding: 12px; border: 1px solid #e2e8f0;">Ananda memiliki sikap sosial yang baik, mampu bekerja sama dengan teman dan menghargai perbedaan pendapat.</td>
                </tr>
            </table>

            <h3 style="margin: 25px 0 15px 0; border-bottom: 2px solid var(--primary); padding-bottom: 8px; color: var(--primary);">B. PENGETAHUAN DAN KETERAMPILAN</h3>
            <div class="table-responsive">
                <table style="width: 100%; margin-bottom: 30px; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th rowspan="2" style="width: 5%; padding: 12px; background: var(--primary); color: white;">No</th>
                            <th rowspan="2" style="width: 35%; padding: 12px; background: var(--primary); color: white; text-align: left;">Mata Pelajaran</th>
                            <th rowspan="2" style="width: 8%; padding: 12px; background: var(--primary); color: white;">KKM</th>
                            <th colspan="3" style="width: 26%; padding: 12px; background: var(--primary); color: white;">Pengetahuan</th>
                            <th colspan="3" style="width: 26%; padding: 12px; background: var(--primary); color: white;">Keterampilan</th>
                        </tr>
                        <tr>
                            <th style="padding: 12px; background: var(--primary); color: white;">Nilai</th>
                            <th style="padding: 12px; background: var(--primary); color: white;">Predikat</th>
                            <th style="padding: 12px; background: var(--primary); color: white;">Status</th>
                            <th style="padding: 12px; background: var(--primary); color: white;">Nilai</th>
                            <th style="padding: 12px; background: var(--primary); color: white;">Predikat</th>
                            <th style="padding: 12px; background: var(--primary); color: white;">Status</th>
                        </tr>
                    </thead>
                    <tbody id="previewNilai">
                        <!-- Data nilai akan diisi di sini -->
                    </tbody>
                    <tfoot>
                        <tr style="background: var(--light); font-weight: bold;">
                            <td colspan="3" style="padding: 12px; text-align: right; border: 1px solid #e2e8f0;">Rata-rata Kelas</td>
                            <td id="previewAvgP" style="padding: 12px; text-align: center; border: 1px solid #e2e8f0;">0</td>
                            <td style="padding: 12px; text-align: center; border: 1px solid #e2e8f0;">-</td>
                            <td style="padding: 12px; text-align: center; border: 1px solid #e2e8f0;">-</td>
                            <td id="previewAvgK" style="padding: 12px; text-align: center; border: 1px solid #e2e8f0;">0</td>
                            <td style="padding: 12px; text-align: center; border: 1px solid #e2e8f0;">-</td>
                            <td style="padding: 12px; text-align: center; border: 1px solid #e2e8f0;">-</td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <h3 style="margin: 25px 0 15px 0; border-bottom: 2px solid var(--primary); padding-bottom: 8px; color: var(--primary);">C. EKSTRAKURIKULER</h3>
            <table style="width: 100%; margin-bottom: 30px; border-collapse: collapse;">
                <tr>
                    <th style="width: 70%; padding: 12px; background: var(--light); text-align: left; border: 1px solid #e2e8f0;">Kegiatan Ekstrakurikuler</th>
                    <th style="width: 30%; padding: 12px; background: var(--light); text-align: left; border: 1px solid #e2e8f0;">Keterangan</th>
                </tr>
                <tr>
                    <td id="previewEkstra1" style="padding: 12px; border: 1px solid #e2e8f0;">Pramuka</td>
                    <td id="previewNilaiEkstra1" style="padding: 12px; border: 1px solid #e2e8f0;">Sangat Baik</td>
                </tr>
                <tr>
                    <td id="previewEkstra2" style="padding: 12px; border: 1px solid #e2e8f0;">Seni Tari</td>
                    <td id="previewNilaiEkstra2" style="padding: 12px; border: 1px solid #e2e8f0;">Baik</td>
                </tr>
            </table>

            <h3 style="margin: 25px 0 15px 0; border-bottom: 2px solid var(--primary); padding-bottom: 8px; color: var(--primary);">D. CATATAN</h3>
            <div style="margin-bottom: 30px; padding: 15px; background: var(--light); border-radius: 8px;">
                <p id="previewCatatanWali" style="margin-bottom: 15px;">Ananda adalah siswa yang rajin dan disiplin. Terus pertahankan prestasinya dan tingkatkan kemampuan dalam bekerja sama dengan teman sekelas.</p>
                <p id="previewSaran"><strong>Saran:</strong> Ditingkatkan lagi kedisiplinan dalam mengumpulkan tugas tepat waktu.</p>
            </div>

            <div class="ttd-section">
                <div class="ttd-box">
                    <p>Orang Tua/Wali</p>
                    <div class="ttd-space"></div>
                    <p>(___________________)</p>
                </div>
                <div class="ttd-box">
                    <p id="previewTempatTanggal">Bandung, 20 Juni 2024</p>
                    <p>Wali Kelas</p>
                    <div class="ttd-space"></div>
                    <p id="previewNamaWaliKelas">Dewi Sartika, S.Pd.</p>
                    <p>NIP. 19800312 200501 2 002</p>
                </div>
                <div class="ttd-box">
                    <p>&nbsp;</p>
                    <p>Kepala Sekolah</p>
                    <div class="ttd-space"></div>
                    <p id="previewNamaKepalaSekolah">Dr. Ahmad Fauzi, M.Pd.</p>
                    <p>NIP. 19651231 199203 1 001</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Mapel -->
    <div id="modalMapel" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Tambah Mata Pelajaran</h3>
                <span style="cursor: pointer; font-size: 20px;" onclick="tutupModal()">&times;</span>
            </div>
            <div class="form-group">
                <label for="namaMapelBaru">Nama Mata Pelajaran</label>
                <input type="text" id="namaMapelBaru" class="form-control">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="kkmMapelBaru">KKM</label>
                    <input type="number" id="kkmMapelBaru" class="form-control" min="0" max="100" value="75">
                </div>
                <div class="form-group">
                    <label for="nilaiPBaru">Nilai Pengetahuan</label>
                    <input type="number" id="nilaiPBaru" class="form-control" min="0" max="100">
                </div>
                <div class="form-group">
                    <label for="nilaiKBaru">Nilai Keterampilan</label>
                    <input type="number" id="nilaiKBaru" class="form-control" min="0" max="100">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="tutupModal()">Batal</button>
                <button class="btn btn-success" onclick="simpanMapel()">Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // Data awal
        let mataPelajaran = [
            { nama: "Pendidikan Agama dan Budi Pekerti", kkm: 75, nilaiP: 85, nilaiK: 88 },
            { nama: "Pendidikan Pancasila dan Kewarganegaraan", kkm: 75, nilaiP: 82, nilaiK: 85 },
            { nama: "Bahasa Indonesia", kkm: 75, nilaiP: 80, nilaiK: 83 },
            { nama: "Matematika", kkm: 70, nilaiP: 78, nilaiK: 82 },
            { nama: "Ilmu Pengetahuan Alam", kkm: 75, nilaiP: 85, nilaiK: 87 },
            { nama: "Ilmu Pengetahuan Sosial", kkm: 75, nilaiP: 83, nilaiK: 85 },
            { nama: "Seni Budaya dan Prakarya", kkm: 70, nilaiP: 88, nilaiK: 90 },
            { nama: "Pendidikan Jasmani, Olahraga, dan Kesehatan", kkm: 70, nilaiP: 87, nilaiK: 89 }
        ];

        let editingIndex = -1;

        // Fungsi untuk toggle card
        function toggleCard(header) {
            const card = header.parentElement;
            const body = card.querySelector('.card-body');
            const icon = header.querySelector('.toggle-icon');
            
            if (body.classList.contains('show')) {
                body.classList.remove('show');
                header.classList.add('collapsed');
            } else {
                body.classList.add('show');
                header.classList.remove('collapsed');
            }
        }

        // Fungsi untuk menghitung predikat
        function hitungPredikat(nilai) {
            if (nilai >= 90) return { predikat: "A", kelas: "predikat-A" };
            if (nilai >= 80) return { predikat: "B", kelas: "predikat-B" };
            if (nilai >= 70) return { predikat: "C", kelas: "predikat-C" };
            return { predikat: "D", kelas: "predikat-D" };
        }

        // Fungsi untuk cek tuntas
        function cekTuntas(nilai, kkm) {
            return nilai >= kkm ? "Tuntas" : "Belum Tuntas";
        }

        // Fungsi untuk memuat data legger
        function muatLegger() {
            const tbody = document.getElementById("leggerBody");
            tbody.innerHTML = "";

            let totalP = 0;
            let totalK = 0;
            let count = 0;

            mataPelajaran.forEach((mapel, index) => {
                const predikatP = hitungPredikat(mapel.nilaiP);
                const predikatK = hitungPredikat(mapel.nilaiK);
                const statusP = cekTuntas(mapel.nilaiP, mapel.kkm);
                const statusK = cekTuntas(mapel.nilaiK, mapel.kkm);

                totalP += mapel.nilaiP;
                totalK += mapel.nilaiK;
                count++;

                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td style="text-align: left;">${mapel.nama}</td>
                    <td>${mapel.kkm}</td>
                    <td><input type="number" value="${mapel.nilaiP}" min="0" max="100" onchange="updateNilai(${index}, 'nilaiP', this.value)" style="width: 60px; text-align: center; padding: 5px;"></td>
                    <td><span class="predikat ${predikatP.kelas}">${predikatP.predikat}</span></td>
                    <td class="${statusP === 'Tuntas' ? 'tuntas' : 'tidak-tuntas'}">${statusP}</td>
                    <td><input type="number" value="${mapel.nilaiK}" min="0" max="100" onchange="updateNilai(${index}, 'nilaiK', this.value)" style="width: 60px; text-align: center; padding: 5px;"></td>
                    <td><span class="predikat ${predikatK.kelas}">${predikatK.predikat}</span></td>
                    <td class="${statusK === 'Tuntas' ? 'tuntas' : 'tidak-tuntas'}">${statusK}</td>
                    <td>
                        <button class="btn btn-sm" onclick="editMapel(${index})" style="padding: 5px 8px;"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="hapusMapel(${index})" style="padding: 5px 8px;"><i class="fas fa-trash-alt"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Hitung rata-rata
            const avgP = count > 0 ? (totalP / count).toFixed(2) : 0;
            const avgK = count > 0 ? (totalK / count).toFixed(2) : 0;

            document.getElementById("avgP").textContent = avgP;
            document.getElementById("avgK").textContent = avgK;
        }

        // Fungsi untuk update nilai
        function updateNilai(index, jenis, nilai) {
            const num = parseInt(nilai);
            if (isNaN(num)) return;

            if (jenis === "nilaiP") {
                mataPelajaran[index].nilaiP = num;
            } else {
                mataPelajaran[index].nilaiK = num;
            }

            muatLegger();
        }

        // Fungsi untuk menambah mapel
        function tambahMapel() {
            editingIndex = -1;
            document.getElementById("modalTitle").textContent = "Tambah Mata Pelajaran";
            document.getElementById("namaMapelBaru").value = "";
            document.getElementById("kkmMapelBaru").value = document.getElementById("kkmSekolah").value || 75;
            document.getElementById("nilaiPBaru").value = "";
            document.getElementById("nilaiKBaru").value = "";
            document.getElementById("modalMapel").style.display = "flex";
        }

        // Fungsi untuk edit mapel
        function editMapel(index) {
            editingIndex = index;
            const mapel = mataPelajaran[index];
            document.getElementById("modalTitle").textContent = "Edit Mata Pelajaran";
            document.getElementById("namaMapelBaru").value = mapel.nama;
            document.getElementById("kkmMapelBaru").value = mapel.kkm;
            document.getElementById("nilaiPBaru").value = mapel.nilaiP;
            document.getElementById("nilaiKBaru").value = mapel.nilaiK;
            document.getElementById("modalMapel").style.display = "flex";
        }

        // Fungsi untuk simpan mapel
        function simpanMapel() {
            const nama = document.getElementById("namaMapelBaru").value.trim();
            const kkm = parseInt(document.getElementById("kkmMapelBaru").value) || 75;
            const nilaiP = parseInt(document.getElementById("nilaiPBaru").value) || 0;
            const nilaiK = parseInt(document.getElementById("nilaiKBaru").value) || 0;

            if (!nama) {
                alert("Nama mata pelajaran harus diisi!");
                return;
            }

            if (editingIndex === -1) {
                mataPelajaran.push({ nama, kkm, nilaiP, nilaiK });
            } else {
                mataPelajaran[editingIndex] = { nama, kkm, nilaiP, nilaiK };
            }

            tutupModal();
            muatLegger();
        }

        // Fungsi untuk hapus mapel
        function hapusMapel(index) {
            if (confirm(`Yakin ingin menghapus mata pelajaran "${mataPelajaran[index].nama}"?`)) {
                mataPelajaran.splice(index, 1);
                muatLegger();
            }
        }

        // Fungsi untuk tutup modal
        function tutupModal() {
            document.getElementById("modalMapel").style.display = "none";
        }

        // Fungsi untuk generate rapor
        function generateRapor() {
            // Validasi data
            if (!document.getElementById("namaSiswa").value || 
                !document.getElementById("nis").value || 
                !document.getElementById("kelas").value) {
                alert("Data siswa belum lengkap!");
                return;
            }

            // Update data sekolah
            document.getElementById("previewNamaSekolah").textContent = document.getElementById("namaSekolah").value.toUpperCase();
            document.getElementById("previewSekolahLengkap").textContent = document.getElementById("namaSekolah").value;
            
            // Update data siswa
            document.getElementById("previewNamaSiswa").textContent = document.getElementById("namaSiswa").value;
            document.getElementById("previewNIS").textContent = document.getElementById("nis").value + " / " + document.getElementById("nisn").value;
            document.getElementById("previewKelas").textContent = "Kelas " + document.getElementById("kelas").value + 
                (document.getElementById("kelas").value === "I" ? " (Satu)" : 
                 document.getElementById("kelas").value === "II" ? " (Dua)" : 
                 document.getElementById("kelas").value === "III" ? " (Tiga)" : 
                 document.getElementById("kelas").value === "IV" ? " (Empat)" : 
                 document.getElementById("kelas").value === "V" ? " (Lima)" : " (Enam)");
            document.getElementById("previewSemester").textContent = document.getElementById("semester").value === "1" ? "1 (Ganjil)" : "2 (Genap)";
            document.getElementById("previewTahunAjaran").textContent = document.getElementById("tahunAjaran").value;
            
            // Update wali kelas dan kepala sekolah
            document.getElementById("previewNamaWaliKelas").textContent = document.getElementById("namaWaliKelas").value;
            document.getElementById("previewNamaKepalaSekolah").textContent = document.getElementById("namaKepalaSekolah").value;
            
            // Update tanggal
            const today = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById("previewTempatTanggal").textContent = 
                "Bandung, " + today.toLocaleDateString('id-ID', options);
            
            // Update sikap
            document.getElementById("previewSikapSpiritual").textContent = document.getElementById("sikapSpiritual").value;
            document.getElementById("previewSikapSosial").textContent = document.getElementById("sikapSosial").value;
            
            // Update nilai
            const tbody = document.getElementById("previewNilai");
            tbody.innerHTML = "";
            
            let totalP = 0;
            let totalK = 0;
            let count = 0;
            
            mataPelajaran.forEach((mapel, index) => {
                const predikatP = hitungPredikat(mapel.nilaiP);
                const predikatK = hitungPredikat(mapel.nilaiK);
                const statusP = cekTuntas(mapel.nilaiP, mapel.kkm);
                const statusK = cekTuntas(mapel.nilaiK, mapel.kkm);
                
                totalP += mapel.nilaiP;
                totalK += mapel.nilaiK;
                count++;
                
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td style="text-align: left;">${mapel.nama}</td>
                    <td>${mapel.kkm}</td>
                    <td>${mapel.nilaiP}</td>
                    <td><span class="predikat ${predikatP.kelas}">${predikatP.predikat}</span></td>
                    <td class="${statusP === 'Tuntas' ? 'tuntas' : 'tidak-tuntas'}">${statusP}</td>
                    <td>${mapel.nilaiK}</td>
                    <td><span class="predikat ${predikatK.kelas}">${predikatK.predikat}</span></td>
                    <td class="${statusK === 'Tuntas' ? 'tuntas' : 'tidak-tuntas'}">${statusK}</td>
                `;
                tbody.appendChild(row);
            });
            
            // Update rata-rata
            const avgP = count > 0 ? (totalP / count).toFixed(2) : 0;
            const avgK = count > 0 ? (totalK / count).toFixed(2) : 0;
            
            document.getElementById("previewAvgP").textContent = avgP;
            document.getElementById("previewAvgK").textContent = avgK;
            
            // Update ekstrakurikuler
            document.getElementById("previewEkstra1").textContent = document.getElementById("ekstra1").value;
            document.getElementById("previewNilaiEkstra1").textContent = document.getElementById("nilaiEkstra1").value;
            document.getElementById("previewEkstra2").textContent = document.getElementById("ekstra2").value;
            document.getElementById("previewNilaiEkstra2").textContent = document.getElementById("nilaiEkstra2").value;
            
            // Update catatan
            document.getElementById("previewCatatanWali").textContent = document.getElementById("catatanWali").value;
            document.getElementById("previewSaran").textContent = "Saran: " + (document.getElementById("saran").value || "-");
            
            // Tampilkan preview
            document.getElementById("raporPreview").style.display = "block";
            document.getElementById("raporPreview").scrollIntoView({ behavior: 'smooth' });
        }

        // Fungsi untuk cetak rapor
        function cetakRapor() {
            if (document.getElementById("raporPreview").style.display !== "block") {
                alert("Silakan generate rapor terlebih dahulu!");
                return;
            }
            window.print();
        }

        // Fungsi untuk simpan data ke localStorage
        function simpanData() {
            const data = {
                sekolah: {
                    nama: document.getElementById("namaSekolah").value,
                    npsn: document.getElementById("npsn").value,
                    alamat: document.getElementById("alamatSekolah").value,
                    kepalaSekolah: document.getElementById("namaKepalaSekolah").value,
                    nipKepalaSekolah: document.getElementById("nipKepalaSekolah").value,
                    kkm: document.getElementById("kkmSekolah").value
                },
                siswa: {
                    nama: document.getElementById("namaSiswa").value,
                    nis: document.getElementById("nis").value,
                    nisn: document.getElementById("nisn").value,
                    kelas: document.getElementById("kelas").value,
                    semester: document.getElementById("semester").value,
                    tahunAjaran: document.getElementById("tahunAjaran").value,
                    waliKelas: document.getElementById("namaWaliKelas").value,
                    nipWaliKelas: document.getElementById("nipWaliKelas").value
                },
                sikap: {
                    spiritual: document.getElementById("sikapSpiritual").value,
                    sosial: document.getElementById("sikapSosial").value
                },
                ekstrakurikuler: {
                    ekstra1: document.getElementById("ekstra1").value,
                    nilaiEkstra1: document.getElementById("nilaiEkstra1").value,
                    ekstra2: document.getElementById("ekstra2").value,
                    nilaiEkstra2: document.getElementById("nilaiEkstra2").value
                },
                catatan: {
                    wali: document.getElementById("catatanWali").value,
                    saran: document.getElementById("saran").value
                },
                mataPelajaran: mataPelajaran
            };
            
            localStorage.setItem("raporK13Data", JSON.stringify(data));
            alert("Data berhasil disimpan!");
        }

        // Fungsi untuk muat data dari localStorage
        function muatData() {
            const data = JSON.parse(localStorage.getItem("raporK13Data"));
            if (!data) {
                alert("Tidak ada data yang tersimpan!");
                return;
            }
            
            // Muat data sekolah
            document.getElementById("namaSekolah").value = data.sekolah.nama || "";
            document.getElementById("npsn").value = data.sekolah.npsn || "";
            document.getElementById("alamatSekolah").value = data.sekolah.alamat || "";
            document.getElementById("namaKepalaSekolah").value = data.sekolah.kepalaSekolah || "";
            document.getElementById("nipKepalaSekolah").value = data.sekolah.nipKepalaSekolah || "";
            document.getElementById("kkmSekolah").value = data.sekolah.kkm || 75;
            
            // Muat data siswa
            document.getElementById("namaSiswa").value = data.siswa.nama || "";
            document.getElementById("nis").value = data.siswa.nis || "";
            document.getElementById("nisn").value = data.siswa.nisn || "";
            document.getElementById("kelas").value = data.siswa.kelas || "";
            document.getElementById("semester").value = data.siswa.semester || "";
            document.getElementById("tahunAjaran").value = data.siswa.tahunAjaran || "";
            document.getElementById("namaWaliKelas").value = data.siswa.waliKelas || "";
            document.getElementById("nipWaliKelas").value = data.siswa.nipWaliKelas || "";
            
            // Muat sikap
            document.getElementById("sikapSpiritual").value = data.sikap.spiritual || "";
            document.getElementById("sikapSosial").value = data.sikap.sosial || "";
            
            // Muat ekstrakurikuler
            document.getElementById("ekstra1").value = data.ekstrakurikuler.ekstra1 || "";
            document.getElementById("nilaiEkstra1").value = data.ekstrakurikuler.nilaiEkstra1 || "";
            document.getElementById("ekstra2").value = data.ekstrakurikuler.ekstra2 || "";
            document.getElementById("nilaiEkstra2").value = data.ekstrakurikuler.nilaiEkstra2 || "";
            
            // Muat catatan
            document.getElementById("catatanWali").value = data.catatan.wali || "";
            document.getElementById("saran").value = data.catatan.saran || "";
            
            // Muat mata pelajaran
            mataPelajaran = data.mataPelajaran || [];
            
            muatLegger();
            alert("Data berhasil dimuat!");
        }

        // Fungsi untuk reset data
        function resetData() {
            if (confirm("Apakah Anda yakin ingin mereset semua data ke nilai default?")) {
                // Reset data sekolah
                document.getElementById("namaSekolah").value = "SDN 01 Contoh";
                document.getElementById("npsn").value = "12345678";
                document.getElementById("alamatSekolah").value = "Jl. Pendidikan No. 1, Kota Contoh";
                document.getElementById("namaKepalaSekolah").value = "Dr. Ahmad Fauzi, M.Pd.";
                document.getElementById("nipKepalaSekolah").value = "19651231 199203 1 001";
                document.getElementById("kkmSekolah").value = 75;
                
                // Reset data siswa
                document.getElementById("namaSiswa").value = "Ananda Putri";
                document.getElementById("nis").value = "12345";
                document.getElementById("nisn").value = "9876543210";
                document.getElementById("kelas").value = "V";
                document.getElementById("semester").value = "2";
                document.getElementById("tahunAjaran").value = "2024/2025";
                document.getElementById("namaWaliKelas").value = "Dewi Sartika, S.Pd.";
                document.getElementById("nipWaliKelas").value = "19800312 200501 2 002";
                
                // Reset sikap
                document.getElementById("sikapSpiritual").value = "Ananda menunjukkan sikap spiritual yang baik, selalu berdoa sebelum dan sesudah kegiatan pembelajaran.";
                document.getElementById("sikapSosial").value = "Ananda memiliki sikap sosial yang baik, mampu bekerja sama dengan teman dan menghargai perbedaan pendapat.";
                
                // Reset ekstrakurikuler
                document.getElementById("ekstra1").value = "Pramuka";
                document.getElementById("nilaiEkstra1").value = "Baik";
                document.getElementById("ekstra2").value = "Seni Tari";
                document.getElementById("nilaiEkstra2").value = "Sangat Baik";
                
                // Reset catatan
                document.getElementById("catatanWali").value = "Ananda adalah siswa yang rajin dan disiplin. Terus pertahankan prestasinya dan tingkatkan kemampuan dalam bekerja sama dengan teman sekelas.";
                document.getElementById("saran").value = "Ditingkatkan lagi kedisiplinan dalam mengumpulkan tugas tepat waktu.";
                
                // Reset mata pelajaran
                mataPelajaran = [
                    { nama: "Pendidikan Agama dan Budi Pekerti", kkm: 75, nilaiP: 85, nilaiK: 88 },
                    { nama: "Pendidikan Pancasila dan Kewarganegaraan", kkm: 75, nilaiP: 82, nilaiK: 85 },
                    { nama: "Bahasa Indonesia", kkm: 75, nilaiP: 80, nilaiK: 83 },
                    { nama: "Matematika", kkm: 70, nilaiP: 78, nilaiK: 82 },
                    { nama: "Ilmu Pengetahuan Alam", kkm: 75, nilaiP: 85, nilaiK: 87 },
                    { nama: "Ilmu Pengetahuan Sosial", kkm: 75, nilaiP: 83, nilaiK: 85 },
                    { nama: "Seni Budaya dan Prakarya", kkm: 70, nilaiP: 88, nilaiK: 90 },
                    { nama: "Pendidikan Jasmani, Olahraga, dan Kesehatan", kkm: 70, nilaiP: 87, nilaiK: 89 }
                ];
                
                muatLegger();
                document.getElementById("raporPreview").style.display = "none";
            }
        }

        // Inisialisasi saat halaman dimuat
        window.onload = function() {
            muatLegger();
            
            // Buka card legger secara default
            document.querySelector('.card-header').click();
            
            // Cek apakah ada data tersimpan
            if (localStorage.getItem("raporK13Data")) {
                if (confirm("Ada data tersimpan. Mau dimuat sekarang?")) {
                    muatData();
                }
            }
        };
    </script>
</body>
</html>
