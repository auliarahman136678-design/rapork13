<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapor K13 SD - Revisi 2019</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-block;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
        }

        .subject-list {
            margin-top: 20px;
        }

        .subject-item {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .subject-item:hover {
            border-color: #667eea;
            background: #edf2f7;
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .subject-name {
            font-weight: 700;
            color: #2d3748;
            font-size: 1.1em;
            flex: 1;
        }

        .subject-actions {
            display: flex;
            gap: 5px;
        }

        .nilai-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .nilai-group {
            text-align: center;
        }

        .nilai-group input {
            text-align: center;
            font-weight: 600;
        }

        .predikat-display {
            margin-top: 5px;
            padding: 5px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .predikat-A { background: #c6f6d5; color: #22543d; }
        .predikat-B { background: #bee3f8; color: #2a4365; }
        .predikat-C { background: #faf089; color: #744210; }
        .predikat-D { background: #fed7d7; color: #742a2a; }

        .deskripsi-section {
            margin-top: 15px;
        }

        .deskripsi-section textarea {
            min-height: 80px;
            resize: vertical;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 30px;
            cursor: pointer;
            color: #a0aec0;
            line-height: 1;
        }

        .close:hover {
            color: #2d3748;
        }

        .rapor-preview {
            background: white;
            border-radius: 15px;
            padding: 40px;
            margin-top: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            display: none;
        }

        .rapor-preview.show {
            display: block;
        }

        .rapor-header {
            text-align: center;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .rapor-header h1 {
            color: #2d3748;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .student-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .info-section {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #4a5568;
        }

        .info-value {
            color: #2d3748;
            font-weight: 500;
        }

        .nilai-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .nilai-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
        }

        .nilai-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }

        .nilai-table td:nth-child(2) {
            text-align: left;
            padding-left: 20px;
        }

        .nilai-table tr:nth-child(even) {
            background: #f7fafc;
        }

        .predikat-cell {
            font-weight: bold;
            padding: 8px 12px;
            border-radius: 20px;
            color: white;
            display: inline-block;
            min-width: 30px;
        }

        .predikat-cell.A { background: #38a169; }
        .predikat-cell.B { background: #3182ce; }
        .predikat-cell.C { background: #d69e2e; }
        .predikat-cell.D { background: #e53e3e; }

        .deskripsi-kompetensi {
            margin-top: 30px;
        }

        .deskripsi-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .deskripsi-title {
            color: #4a5568;
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .deskripsi-text {
            margin-bottom: 10px;
            text-align: justify;
            line-height: 1.6;
        }

        .alert {
            background: #fed7d7;
            color: #742a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #feb2b2;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
            border-color: #9ae6b4;
        }

        .ekstrakurikuler-list {
            margin-top: 20px;
        }

        .ekstrakurikuler-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .sikap-section {
            margin-top: 30px;
        }

        .sikap-item {
            margin-bottom: 20px;
        }

        .catatan-wali {
            margin-top: 30px;
        }

        .footer-rapor {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .ttd-section {
            text-align: center;
            margin-top: 50px;
        }

        .ttd-space {
            height: 80px;
            margin: 20px 0;
            border-bottom: 1px solid #2d3748;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .subject-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .subject-actions {
                justify-content: center;
            }
            
            .nilai-inputs {
                grid-template-columns: 1fr;
            }

            .rapor-preview {
                padding: 20px;
            }

            .student-info-grid {
                grid-template-columns: 1fr;
            }

            .footer-rapor {
                grid-template-columns: 1fr;
            }
        }

        @media print {
            body {
                background: white;
                color: black;
            }
            
            .container > .card, .btn {
                display: none;
            }
            
            .rapor-preview {
                box-shadow: none;
                margin: 0;
                padding: 20px;
            }

            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📚 Rapor K13 SD</h1>
            <p>Kurikulum 2013 Revisi 2019 - Sekolah Dasar</p>
        </div>

        <!-- Data Siswa -->
        <div class="card">
            <h2>📝 Data Siswa</h2>
            <div class="form-group">
                <label for="namaSekolah">Nama Sekolah:</label>
                <input type="text" id="namaSekolah" placeholder="Masukkan nama sekolah" value="SDN 01 Contoh">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="namaSiswa">Nama Siswa:</label>
                    <input type="text" id="namaSiswa" placeholder="Masukkan nama siswa" value="Ananda Putri">
                </div>
                <div class="form-group">
                    <label for="nis">NIS:</label>
                    <input type="text" id="nis" placeholder="Masukkan NIS" value="12345">
                </div>
                <div class="form-group">
                    <label for="nisn">NISN:</label>
                    <input type="text" id="nisn" placeholder="Masukkan NISN" value="9876543210">
                </div>
                <div class="form-group">
                    <label for="kelas">Kelas:</label>
                    <select id="kelas">
                        <option value="">Pilih Kelas</option>
                        <option value="I">I (Satu)</option>
                        <option value="II">II (Dua)</option>
                        <option value="III">III (Tiga)</option>
                        <option value="IV">IV (Empat)</option>
                        <option value="V" selected>V (Lima)</option>
                        <option value="VI">VI (Enam)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="semester">Semester:</label>
                    <select id="semester">
                        <option value="">Pilih Semester</option>
                        <option value="Ganjil">Ganjil</option>
                        <option value="Genap" selected>Genap</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="tahunAjaran">Tahun Ajaran:</label>
                    <input type="text" id="tahunAjaran" placeholder="Contoh: 2024/2025" value="2024/2025">
                </div>
            </div>
        </div>

        <!-- Mata Pelajaran -->
        <div class="card">
            <h2>📋 Mata Pelajaran & Nilai</h2>
            <button class="btn btn-success" onclick="showTambahMapelModal()">+ Tambah Mata Pelajaran</button>
            <div id="subjectList" class="subject-list">
                <!-- Mata pelajaran akan ditampilkan di sini -->
            </div>
        </div>

        <!-- Ekstrakurikuler -->
        <div class="card">
            <h2>⚽ Ekstrakurikuler</h2>
            <div class="form-group">
                <label for="inputEkstrakurikuler">Nama Ekstrakurikuler:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="inputEkstrakurikuler" placeholder="Masukkan nama ekstrakurikuler" style="flex: 1;">
                    <button class="btn btn-success" onclick="tambahEkstrakurikuler()">+ Tambah</button>
                </div>
            </div>
            <div id="ekstrakurikulerList" class="ekstrakurikuler-list">
                <!-- Daftar ekstrakurikuler akan ditampilkan di sini -->
            </div>
        </div>

        <!-- Sikap -->
        <div class="card">
            <h2>😊 Sikap</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="sikapSpiritual">Deskripsi Sikap Spiritual:</label>
                    <textarea id="sikapSpiritual" placeholder="Deskripsi sikap spiritual siswa">Ananda menunjukkan sikap spiritual yang baik, selalu berdoa sebelum dan sesudah kegiatan pembelajaran.</textarea>
                </div>
                <div class="form-group">
                    <label for="sikapSosial">Deskripsi Sikap Sosial:</label>
                    <textarea id="sikapSosial" placeholder="Deskripsi sikap sosial siswa">Ananda memiliki sikap sosial yang baik, mampu bekerja sama dengan teman dan menghargai perbedaan pendapat.</textarea>
                </div>
            </div>
        </div>

        <!-- Catatan Wali Kelas -->
        <div class="card">
            <h2>📝 Catatan Wali Kelas</h2>
            <div class="form-group">
                <textarea id="catatanWali" placeholder="Masukkan catatan untuk siswa" style="min-height: 100px;">Ananda adalah siswa yang rajin dan disiplin. Terus pertahankan prestasinya dan tingkatkan kemampuan dalam bekerja sama dengan teman sekelas.</textarea>
            </div>
        </div>

        <!-- Tombol Aksi -->
        <div class="card">
            <button class="btn btn-success" onclick="generateRapor()">🎓 Generate Rapor</button>
            <button class="btn" onclick="cetakRapor()">🖨️ Cetak/Simpan PDF</button>
            <button class="btn btn-danger" onclick="resetData()">🗑️ Reset Semua</button>
            <button class="btn no-print" onclick="simpanData()">💾 Simpan Data</button>
            <button class="btn no-print" onclick="loadData()">📂 Muat Data</button>
        </div>

        <!-- Preview Rapor -->
        <div id="raporPreview" class="rapor-preview">
            <div class="rapor-header">
                <h1>RAPOR SISWA</h1>
                <h2 id="previewSekolah">SDN 01 Contoh</h2>
                <p>Kurikulum 2013 Revisi 2019</p>
            </div>
            
            <div class="student-info-grid">
                <div class="info-section">
                    <div class="info-item">
                        <span class="info-label">Nama Siswa</span>
                        <span class="info-value" id="previewNama">Ananda Putri</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">NIS</span>
                        <span class="info-value" id="previewNIS">12345</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">NISN</span>
                        <span class="info-value" id="previewNISN">9876543210</span>
                    </div>
                </div>
                <div class="info-section">
                    <div class="info-item">
                        <span class="info-label">Kelas</span>
                        <span class="info-value" id="previewKelas">V (Lima)</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Semester</span>
                        <span class="info-value" id="previewSemester">Genap</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Tahun Ajaran</span>
                        <span class="info-value" id="previewTahun">2024/2025</span>
                    </div>
                </div>
            </div>

            <!-- Sikap -->
            <div class="sikap-section">
                <h3 style="color: #2d3748; margin-bottom: 20px;">😊 Sikap</h3>
                <div class="deskripsi-item">
                    <div class="deskripsi-title">Sikap Spiritual</div>
                    <div class="deskripsi-text" id="previewSikapSpiritual">Ananda menunjukkan sikap spiritual yang baik, selalu berdoa sebelum dan sesudah kegiatan pembelajaran.</div>
                </div>
                <div class="deskripsi-item">
                    <div class="deskripsi-title">Sikap Sosial</div>
                    <div class="deskripsi-text" id="previewSikapSosial">Ananda memiliki sikap sosial yang baik, mampu bekerja sama dengan teman dan menghargai perbedaan pendapat.</div>
                </div>
            </div>

            <!-- Nilai -->
            <h3 style="color: #2d3748; margin-bottom: 20px;">🎯 Capaian Hasil Belajar</h3>
            
            <table class="nilai-table">
                <thead>
                    <tr>
                        <th rowspan="2" style="width: 5%;">No</th>
                        <th rowspan="2" style="width: 35%;">Mata Pelajaran</th>
                        <th colspan="2" style="width: 30%;">Pengetahuan</th>
                        <th colspan="2" style="width: 30%;">Keterampilan</th>
                    </tr>
                    <tr>
                        <th>Nilai</th>
                        <th>Predikat</th>
                        <th>Nilai</th>
                        <th>Predikat</th>
                    </tr>
                </thead>
                <tbody id="nilaiTableBody">
                    <!-- Data nilai akan diisi di sini -->
                </tbody>
            </table>

            <!-- Deskripsi Kompetensi -->
            <div id="deskripsiKompetensi" class="deskripsi-kompetensi">
                <h3 style="color: #2d3748; margin-bottom: 20px;">📋 Deskripsi Capaian Kompetensi</h3>
                <!-- Deskripsi akan diisi di sini -->
            </div>

            <!-- Ekstrakurikuler -->
            <div class="ekstrakurikuler-section">
                <h3 style="color: #2d3748; margin-bottom: 20px;">⚽ Kegiatan Ekstrakurikuler</h3>
                <div id="previewEkstrakurikuler" class="info-section">
                    <!-- Daftar ekstrakurikuler akan diisi di sini -->
                </div>
            </div>

            <!-- Catatan Wali Kelas -->
            <div class="catatan-wali">
                <h3 style="color: #2d3748; margin-bottom: 20px;">📝 Catatan Wali Kelas</h3>
                <div class="deskripsi-item">
                    <div class="deskripsi-text" id="previewCatatanWali">Ananda adalah siswa yang rajin dan disiplin. Terus pertahankan prestasinya dan tingkatkan kemampuan dalam bekerja sama dengan teman sekelas.</div>
                </div>
            </div>

            <!-- Footer Rapor -->
            <div class="footer-rapor">
                <div class="ttd-section">
                    <div>Mengetahui,</div>
                    <div>Orang Tua/Wali</div>
                    <div class="ttd-space"></div>
                    <div>(___________________)</div>
                </div>
                <div class="ttd-section">
                    <div id="previewTempatTanggal"></div>
                    <div>Wali Kelas</div>
                    <div class="ttd-space"></div>
                    <div>(___________________)</div>
                    <div id="previewNamaWaliKelas"></div>
                </div>
                <div class="ttd-section">
                    <div>&nbsp;</div>
                    <div>Kepala Sekolah</div>
                    <div class="ttd-space"></div>
                    <div>(___________________)</div>
                    <div id="previewNamaKepalaSekolah"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Mata Pelajaran -->
    <div id="modalTambahMapel" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>➕ Tambah Mata Pelajaran</h2>
                <span class="close" onclick="closeTambahMapelModal()">&times;</span>
            </div>
            <div class="form-group">
                <label for="inputNamaMapel">Nama Mata Pelajaran:</label>
                <input type="text" id="inputNamaMapel" placeholder="Masukkan nama mata pelajaran">
            </div>
            <button class="btn btn-success" onclick="tambahMataPelajaran()">💾 Simpan</button>
            <button class="btn" onclick="closeTambahMapelModal()">❌ Batal</button>
        </div>
    </div>

    <script>
        // Data global
        let mataPelajaranData = [];
        let ekstrakurikulerData = [];
        let editingIndex = -1;
        let namaWaliKelas = "Dewi Sartika, S.Pd.";
        let namaKepalaSekolah = "Dr. Ahmad Fauzi, M.Pd.";

        // Mata pelajaran default K13 SD
        const defaultMapel = [
            'Pendidikan Agama dan Budi Pekerti',
            'Pendidikan Pancasila dan Kewarganegaraan', 
            'Bahasa Indonesia',
            'Matematika',
            'Ilmu Pengetahuan Alam',
            'Ilmu Pengetahuan Sosial',
            'Seni Budaya dan Prakarya',
            'Pendidikan Jasmani, Olahraga, dan Kesehatan'
        ];

        // Inisialisasi aplikasi
        function initApp() {
            console.log('Initializing app...');
            
            // Load mata pelajaran default
            defaultMapel.forEach(nama => {
                mataPelajaranData.push({
                    nama: nama,
                    nilaiP: Math.floor(Math.random() * 30) + 70, // Nilai random 70-100
                    nilaiK: Math.floor(Math.random() * 30) + 70,
                    deskripsiP: generateRandomDeskripsi(nama, 'pengetahuan'),
                    deskripsiK: generateRandomDeskripsi(nama, 'keterampilan')
                });
            });
            
            // Load contoh ekstrakurikuler
            ekstrakurikulerData = ['Pramuka', 'Seni Tari'];
            
            renderSubjectList();
            renderEkstrakurikulerList();
            
            // Set tanggal
            const today = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('previewTempatTanggal').textContent = 
                `Bandung, ${today.toLocaleDateString('id-ID', options)}`;
            document.getElementById('previewNamaWaliKelas').textContent = namaWaliKelas;
            document.getElementById('previewNamaKepalaSekolah').textContent = namaKepalaSekolah;
        }

        // Fungsi untuk membuat deskripsi acak
        function generateRandomDeskripsi(mapel, jenis) {
            const kataKerjaP = ['memahami', 'menguasai', 'mengetahui', 'mengenal', 'menjelaskan'];
            const kataKerjaK = ['melakukan', 'mempraktikkan', 'menerapkan', 'menyajikan', 'membuat'];
            const tingkat = ['sangat baik', 'baik', 'cukup baik', 'perlu bimbingan'];
            
            const kataKerja = jenis === 'pengetahuan' ? 
                kataKerjaP[Math.floor(Math.random() * kataKerjaP.length)] : 
                kataKerjaK[Math.floor(Math.random() * kataKerjaK.length)];
            
            const randomTingkat = tingkat[Math.floor(Math.random() * tingkat.length)];
            
            return `Siswa ${kataKerja} kompetensi ${mapel.toLowerCase()} dengan ${randomTingkat}.`;
        }

        // Render daftar mata pelajaran
        function renderSubjectList() {
            console.log('Rendering subject list...');
            const container = document.getElementById('subjectList');
            container.innerHTML = '';

            mataPelajaranData.forEach((mapel, index) => {
                const predikatP = hitungPredikat(mapel.nilaiP);
                const predikatK = hitungPredikat(mapel.nilaiK);

                const subjectDiv = document.createElement('div');
                subjectDiv.className = 'subject-item';
                subjectDiv.innerHTML = `
                    <div class="subject-header">
                        <span class="subject-name">${mapel.nama}</span>
                        <div class="subject-actions">
                            <button class="btn btn-small" onclick="editMataPelajaran(${index})">✏️ Edit</button>
                            <button class="btn btn-danger btn-small" onclick="hapusMataPelajaran(${index})">🗑️ Hapus</button>
                        </div>
                    </div>
                    
                    <div class="nilai-inputs">
                        <div class="nilai-group">
                            <label>Nilai Pengetahuan (P):</label>
                            <input type="number" min="0" max="100" value="${mapel.nilaiP}" 
                                   onchange="updateNilai(${index}, 'nilaiP', this.value)" 
                                   placeholder="0-100">
                            <div class="predikat-display predikat-${predikatP}">
                                ${predikatP ? `Predikat: ${predikatP}` : 'Belum ada nilai'}
                            </div>
                        </div>
                        <div class="nilai-group">
                            <label>Nilai Keterampilan (K):</label>
                            <input type="number" min="0" max="100" value="${mapel.nilaiK}" 
                                   onchange="updateNilai(${index}, 'nilaiK', this.value)" 
                                   placeholder="0-100">
                            <div class="predikat-display predikat-${predikatK}">
                                ${predikatK ? `Predikat: ${predikatK}` : 'Belum ada nilai'}
                            </div>
                        </div>
                    </div>

                    <div class="deskripsi-section">
                        <div class="form-group">
                            <label>📝 Deskripsi Pencapaian Pengetahuan:</label>
                            <textarea placeholder="Tuliskan pencapaian kompetensi pengetahuan siswa..." 
                                      onchange="updateNilai(${index}, 'deskripsiP', this.value)">${mapel.deskripsiP}</textarea>
                        </div>
                        <div class="form-group">
                            <label>🎯 Deskripsi Pencapaian Keterampilan:</label>
                            <textarea placeholder="Tuliskan pencapaian kompetensi keterampilan siswa..." 
                                      onchange="updateNilai(${index}, 'deskripsiK', this.value)">${mapel.deskripsiK}</textarea>
                        </div>
                    </div>
                `;
                container.appendChild(subjectDiv);
            });
        }

        // Render daftar ekstrakurikuler
        function renderEkstrakurikulerList() {
            const container = document.getElementById('ekstrakurikulerList');
            container.innerHTML = '';

            ekstrakurikulerData.forEach((ekstra, index) => {
                const ekstraDiv = document.createElement('div');
                ekstraDiv.className = 'ekstrakurikuler-item';
                ekstraDiv.innerHTML = `
                    <span>${ekstra}</span>
                    <button class="btn btn-danger btn-small" onclick="hapusEkstrakurikuler(${index})">🗑️ Hapus</button>
                `;
                container.appendChild(ekstraDiv);
            });
        }

        // Hitung predikat berdasarkan nilai
        function hitungPredikat(nilai) {
            const num = parseFloat(nilai);
            if (isNaN(num) || num === '') return '';
            if (num >= 90) return 'A';
            if (num >= 80) return 'B'; 
            if (num >= 70) return 'C';
            return 'D';
        }

        // Update nilai mata pelajaran
        function updateNilai(index, field, value) {
            console.log(`Updating ${field} for subject ${index}: ${value}`);
            mataPelajaranData[index][field] = value;
            renderSubjectList();
        }

        // Show modal tambah mata pelajaran
        function showTambahMapelModal() {
            document.getElementById('inputNamaMapel').value = '';
            editingIndex = -1;
            document.getElementById('modalTambahMapel').classList.add('show');
        }

        // Close modal tambah mata pelajaran
        function closeTambahMapelModal() {
            document.getElementById('modalTambahMapel').classList.remove('show');
        }

        // Tambah mata pelajaran baru
        function tambahMataPelajaran() {
            const nama = document.getElementById('inputNamaMapel').value.trim();
            
            if (!nama) {
                alert('Nama mata pelajaran harus diisi!');
                return;
            }

            // Cek duplikasi
            const isDuplicate = mataPelajaranData.some(mapel => 
                mapel.nama.toLowerCase() === nama.toLowerCase()
            );

            if (isDuplicate) {
                alert('Mata pelajaran dengan nama tersebut sudah ada!');
                return;
            }

            if (editingIndex === -1) {
                // Tambah baru
                mataPelajaranData.push({
                    nama: nama,
                    nilaiP: '',
                    nilaiK: '',
                    deskripsiP: '',
                    deskripsiK: ''
                });
            } else {
                // Edit existing
                mataPelajaranData[editingIndex].nama = nama;
            }

            renderSubjectList();
            closeTambahMapelModal();
        }

        // Edit mata pelajaran
        function editMataPelajaran(index) {
            editingIndex = index;
            document.getElementById('inputNamaMapel').value = mataPelajaranData[index].nama;
            document.getElementById('modalTambahMapel').classList.add('show');
        }

        // Hapus mata pelajaran
        function hapusMataPelajaran(index) {
            if (confirm(`Yakin ingin menghapus mata pelajaran "${mataPelajaranData[index].nama}"?`)) {
                mataPelajaranData.splice(index, 1);
                renderSubjectList();
            }
        }

        // Tambah ekstrakurikuler
        function tambahEkstrakurikuler() {
            const input = document.getElementById('inputEkstrakurikuler');
            const nama = input.value.trim();
            
            if (!nama) {
                alert('Nama ekstrakurikuler harus diisi!');
                return;
            }

            if (ekstrakurikulerData.includes(nama)) {
                alert('Ekstrakurikuler ini sudah ada!');
                return;
            }

            ekstrakurikulerData.push(nama);
            input.value = '';
            renderEkstrakurikulerList();
        }

        // Hapus ekstrakurikuler
        function hapusEkstrakurikuler(index) {
            if (confirm(`Yakin ingin menghapus ekstrakurikuler "${ekstrakurikulerData[index]}"?`)) {
                ekstrakurikulerData.splice(index, 1);
                renderEkstrakurikulerList();
            }
        }

        // Generate rapor
        function generateRapor() {
            console.log('Generating rapor...');

            // Validasi data siswa
            const namaSekolah = document.getElementById('namaSekolah').value.trim();
            const namaSiswa = document.getElementById('namaSiswa').value.trim();
            const nis = document.getElementById('nis').value.trim();
            const nisn = document.getElementById('nisn').value.trim();
            const kelas = document.getElementById('kelas').value;
            const semester = document.getElementById('semester').value;
            const tahunAjaran = document.getElementById('tahunAjaran').value.trim();

            if (!namaSekolah || !namaSiswa || !nis || !nisn || !kelas || !semester || !tahunAjaran) {
                alert('Semua data siswa harus diisi terlebih dahulu!');
                return;
            }

            // Update preview data siswa
            document.getElementById('previewSekolah').textContent = namaSekolah;
            document.getElementById('previewNama').textContent = namaSiswa;
            document.getElementById('previewNIS').textContent = nis;
            document.getElementById('previewNISN').textContent = nisn;
            document.getElementById('previewKelas').textContent = `${kelas} (${terbilangKelas(kelas)})`;
            document.getElementById('previewSemester').textContent = semester;
            document.getElementById('previewTahun').textContent = tahunAjaran;

            // Update sikap
            document.getElementById('previewSikapSpiritual').textContent = 
                document.getElementById('sikapSpiritual').value || '-';
            document.getElementById('previewSikapSosial').textContent = 
                document.getElementById('sikapSosial').value || '-';

            // Update catatan wali kelas
            document.getElementById('previewCatatanWali').textContent = 
                document.getElementById('catatanWali').value || '-';

            // Generate tabel nilai
            const tbody = document.getElementById('nilaiTableBody');
            tbody.innerHTML = '';

            mataPelajaranData.forEach((mapel, index) => {
                const nilaiP = parseFloat(mapel.nilaiP) || 0;
                const nilaiK = parseFloat(mapel.nilaiK) || 0;
                const predikatP = hitungPredikat(nilaiP);
                const predikatK = hitungPredikat(nilaiK);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${mapel.nama}</td>
                    <td><strong>${nilaiP > 0 ? nilaiP : '-'}</strong></td>
                    <td>${predikatP ? `<span class="predikat-cell ${predikatP}">${predikatP}</span>` : '-'}</td>
                    <td><strong>${nilaiK > 0 ? nilaiK : '-'}</strong></td>
                    <td>${predikatK ? `<span class="predikat-cell ${predikatK}">${predikatK}</span>` : '-'}</td>
                `;
                tbody.appendChild(row);
            });

            // Generate deskripsi kompetensi
            const deskripsiContainer = document.getElementById('deskripsiKompetensi');
            deskripsiContainer.innerHTML = '<h3 style="color: #2d3748; margin-bottom: 20px;">📋 Deskripsi Capaian Kompetensi</h3>';

            mataPelajaranData.forEach((mapel, index) => {
                if (mapel.deskripsiP || mapel.deskripsiK) {
                    const deskripsiDiv = document.createElement('div');
                    deskripsiDiv.className = 'deskripsi-item';
                    deskripsiDiv.innerHTML = `
                        <div class="deskripsi-title">${mapel.nama}</div>
                        ${mapel.deskripsiP ? `<div class="deskripsi-text"><strong>Pengetahuan:</strong> ${mapel.deskripsiP}</div>` : ''}
                        ${mapel.deskripsiK ? `<div class="deskripsi-text"><strong>Keterampilan:</strong> ${mapel.deskripsiK}</div>` : ''}
                    `;
                    deskripsiContainer.appendChild(deskripsiDiv);
                }
            });

            // Generate ekstrakurikuler
            const ekstraContainer = document.getElementById('previewEkstrakurikuler');
            ekstraContainer.innerHTML = '';

            if (ekstrakurikulerData.length > 0) {
                ekstrakurikulerData.forEach(ekstra => {
                    const ekstraDiv = document.createElement('div');
                    ekstraDiv.className = 'info-item';
                    ekstraDiv.innerHTML = `
                        <span class="info-label">${ekstra}</span>
                        <span class="info-value">Sangat Baik</span>
                    `;
                    ekstraContainer.appendChild(ekstraDiv);
                });
            } else {
                ekstraContainer.innerHTML = '<div class="info-item"><span class="info-value">Tidak ada ekstrakurikuler</span></div>';
            }

            // Tampilkan preview rapor
            document.getElementById('raporPreview').classList.add('show');
        }

        // Fungsi untuk mengubah angka kelas menjadi terbilang
        function terbilangKelas(kelas) {
            const terbilang = {
                'I': 'Satu',
                'II': 'Dua',
                'III': 'Tiga',
                'IV': 'Empat',
                'V': 'Lima',
                'VI': 'Enam'
            };
            return terbilang[kelas] || kelas;
        }

        // Cetak rapor
        function cetakRapor() {
            // Pastikan rapor sudah di-generate
            if (!document.getElementById('raporPreview').classList.contains('show')) {
                alert('Silakan generate rapor terlebih dahulu sebelum mencetak!');
                return;
            }
            
            window.print();
        }

        // Reset semua data
        function resetData() {
            if (confirm('Yakin ingin mereset semua data? Semua input akan dikembalikan ke nilai default.')) {
                // Reset data siswa
                document.getElementById('namaSekolah').value = 'SDN 01 Contoh';
                document.getElementById('namaSiswa').value = 'Ananda Putri';
                document.getElementById('nis').value = '12345';
                document.getElementById('nisn').value = '9876543210';
                document.getElementById('kelas').value = 'V';
                document.getElementById('semester').value = 'Genap';
                document.getElementById('tahunAjaran').value = '2024/2025';
                
                // Reset sikap
                document.getElementById('sikapSpiritual').value = 'Ananda menunjukkan sikap spiritual yang baik, selalu berdoa sebelum dan sesudah kegiatan pembelajaran.';
                document.getElementById('sikapSosial').value = 'Ananda memiliki sikap sosial yang baik, mampu bekerja sama dengan teman dan menghargai perbedaan pendapat.';
                
                // Reset catatan wali
                document.getElementById('catatanWali').value = 'Ananda adalah siswa yang rajin dan disiplin. Terus pertahankan prestasinya dan tingkatkan kemampuan dalam bekerja sama dengan teman sekelas.';
                
                // Reset mata pelajaran
                mataPelajaranData = [];
                defaultMapel.forEach(nama => {
                    mataPelajaranData.push({
                        nama: nama,
                        nilaiP: Math.floor(Math.random() * 30) + 70,
                        nilaiK: Math.floor(Math.random() * 30) + 70,
                        deskripsiP: generateRandomDeskripsi(nama, 'pengetahuan'),
                        deskripsiK: generateRandomDeskripsi(nama, 'keterampilan')
                    });
                });
                renderSubjectList();
                
                // Reset ekstrakurikuler
                ekstrakurikulerData = ['Pramuka', 'Seni Tari'];
                renderEkstrakurikulerList();
                
                // Sembunyikan preview
                document.getElementById('raporPreview').classList.remove('show');
                
                alert('Data telah direset ke nilai default!');
            }
        }

        // Simpan data ke localStorage
        function simpanData() {
            const data = {
                siswa: {
                    namaSekolah: document.getElementById('namaSekolah').value,
                    namaSiswa: document.getElementById('namaSiswa').value,
                    nis: document.getElementById('nis').value,
                    nisn: document.getElementById('nisn').value,
                    kelas: document.getElementById('kelas').value,
                    semester: document.getElementById('semester').value,
                    tahunAjaran: document.getElementById('tahunAjaran').value
                },
                sikap: {
                    spiritual: document.getElementById('sikapSpiritual').value,
                    sosial: document.getElementById('sikapSosial').value
                },
                catatanWali: document.getElementById('catatanWali').value,
                mataPelajaran: mataPelajaranData,
                ekstrakurikuler: ekstrakurikulerData,
                namaWaliKelas: namaWaliKelas,
                namaKepalaSekolah: namaKepalaSekolah
            };
            
            localStorage.setItem('raporK13Data', JSON.stringify(data));
            alert('Data berhasil disimpan!');
        }

        // Muat data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem('raporK13Data');
            if (!savedData) {
                alert('Tidak ada data yang tersimpan!');
                return;
            }
            
            const data = JSON.parse(savedData);
            
            // Load data siswa
            document.getElementById('namaSekolah').value = data.siswa.namaSekolah || '';
            document.getElementById('namaSiswa').value = data.siswa.namaSiswa || '';
            document.getElementById('nis').value = data.siswa.nis || '';
            document.getElementById('nisn').value = data.siswa.nisn || '';
            document.getElementById('kelas').value = data.siswa.kelas || '';
            document.getElementById('semester').value = data.siswa.semester || '';
            document.getElementById('tahunAjaran').value = data.siswa.tahunAjaran || '';
            
            // Load sikap
            document.getElementById('sikapSpiritual').value = data.sikap.spiritual || '';
            document.getElementById('sikapSosial').value = data.sikap.sosial || '';
            
            // Load catatan wali
            document.getElementById('catatanWali').value = data.catatanWali || '';
            
            // Load mata pelajaran
            mataPelajaranData = data.mataPelajaran || [];
            renderSubjectList();
            
            // Load ekstrakurikuler
            ekstrakurikulerData = data.ekstrakurikuler || [];
            renderEkstrakurikulerList();
            
            // Load nama guru
            namaWaliKelas = data.namaWaliKelas || 'Dewi Sartika, S.Pd.';
            namaKepalaSekolah = data.namaKepalaSekolah || 'Dr. Ahmad Fauzi, M.Pd.';
            
            alert('Data berhasil dimuat!');
        }

        // Inisialisasi aplikasi saat halaman dimuat
        window.onload = initApp;
    </script>
</body>
</html>